name: CI


on:
  push:
    branches: [ "master" ]

  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      
      - name: Setup pnpm
        uses: pnpm/action-setup@v2.2.2
        with:
          version: '7.11.0'

      - name: install deps
        run: pnpm install
        

      - name: copy dist to zzall.github.io
        run: |
          echo 到123
          
          
          
  Post:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
#       - name: SSHPASS SCP Github Action
#         # You may pin to the exact commit or the version.
#         # uses: youxingz/sshpass-scp-action@886f74a4a1c1bd9c6bb7b6f7db7c080ed8f9baff
#         uses: youxingz/sshpass-scp-action@v3
#         with:
#           # SSHPASS host
#           host: root@150.158.182.28
#           # SSHPASS port
# #           port: # optional, default is 22
#           # SSHPASS username
#           user: root
#           # SSHPASS password
#           pass: 2795770771zzz...
#           # SSHPASS private key
# #           key: # optional
#           # Source Files
#           src: ./app.js
#           # Remote target directory
#           dist: /root/node-services/testDeploy
      
      - name: post to tencent centos services
        run: |
          echo 更改之前
          cat /etc/ssh/sshd_config
          # sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
          echo 更改之后
          cat /etc/ssh/sshd_config
          echo ls之前：
          ls
          echo 之后的是：
          apt-get -v
          sshpass -v
          # apt-get  install sshpass
          echo 开始上传~
          # sshpass -p ${{ secrets.TENCENT_CENTOS_PASSWORD }} scp ./* root@150.158.182.28:/root/node-services/testDeploy
          
          # sshpass -p 2795770771zzz... scp ./app.js root@150.158.182.28:/root/node-services/testDeploy
          
          echo 已上传成功~
          
#       - name: SSHPASS Github Action
#         # You may pin to the exact commit or the version.
#         # uses: matheusvanzan/sshpass-action@1e96f05518c2e99d17587ee85fa4d64c1612d0f1
#         uses: matheusvanzan/sshpass-action@v1
#         with:
#           # SSHPASS host
#           host: root@150.158.182.28
#           # SSHPASS username
#           username: root
#           # SSHPASS password
#           password: 2795770771zzz...
#           # SSHPASS commands to run
#           run: scp ./app.js root@150.158.182.28:/root/node-services/testDeploy
          
      
        
